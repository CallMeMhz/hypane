<!-- Card Partial - renders a single card based on type -->
<div 
  id="card-{{ card.id }}"
  class="card card-{{ card.size or 'medium' }}"
  hx-get="/cards/{{ card.id }}"
  hx-trigger="refresh-{{ card.id }} from:body"
  hx-swap="outerHTML"
>
  <!-- Card Header -->
  <div class="flex items-center justify-between mb-3 group/header">
    <div class="flex items-center gap-2 relative">
      {% if card.titleColor %}
        <h3 class="text-sm font-medium" style="color: {{ card.titleColor }}">{{ card.title }}</h3>
      {% elif card.titleClass %}
        <h3 class="text-sm font-medium {{ card.titleClass }}">{{ card.title }}</h3>
      {% else %}
        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-200">{{ card.title }}</h3>
      {% endif %}
      <!-- Magic wand button - appears on hover after delay -->
      <button 
        class="card-wand-btn opacity-0 group-hover/header:opacity-100 transition-opacity duration-200 delay-500
               p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-300 dark:text-gray-600 hover:text-gray-500 dark:hover:text-gray-300"
        onclick="insertCardToChat('{{ card.id }}', '{{ card.title | e }}', '{{ card.type }}')"
        title="Add to chat"
      >
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
                d="M5 3l3.5 3.5M5 3v4m0-4H1m11 1l-1 1m4-2l1-1m-8 8l-4 4m0 0l3.5-1m-3.5 1l1-3.5M19 13l-6 6m6-6l-4-1m4 1l1 4" />
        </svg>
      </button>
    </div>
    {% if card.updatedAt %}
    <span class="text-xs text-gray-300 dark:text-gray-600">
      {{ card.updatedAt[:10] }}
    </span>
    {% endif %}
  </div>

  <!-- Card Content by Type -->
  {% if card.type == 'weather' %}
    {% include "components/weather.html" %}
  {% elif card.type == 'todo' %}
    {% include "components/todo.html" %}
  {% elif card.type == 'news-single' %}
    {% include "components/news.html" %}
  {% elif card.type == 'news-bundle' %}
    {% include "components/news_bundle.html" %}
  {% elif card.type == 'crypto' %}
    {% include "components/crypto.html" %}
  {% elif card.type == 'crypto-bundle' %}
    {% include "components/crypto_bundle.html" %}
  {% elif card.type == 'reminder' %}
    {% include "components/reminder.html" %}
  {% else %}
    <!-- Custom content: check for HTML or render as JSON -->
    {% if card.content.html %}
      <div class="custom-html-content">
        {{ card.content.html | safe }}
      </div>
    {% else %}
      <div class="text-gray-500 dark:text-gray-400 text-sm">
        <pre class="whitespace-pre-wrap">{{ card.content | tojson(indent=2) }}</pre>
      </div>
    {% endif %}
  {% endif %}
</div>
